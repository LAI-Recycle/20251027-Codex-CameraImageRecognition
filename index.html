<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>人臉辨識</title>
    <link rel="stylesheet" href="styles.css" />
    <script defer src="https://cdn.jsdelivr.net/npm/@vladmandic/face-api/dist/face-api.min.js"></script>
    <script>
      window.__FACE_STORE_CONFIG__ = Object.assign(
        {
          functionsBaseUrl: "https://zfngpdwupwcprnoarykg.functions.supabase.co",
          listPath: "/faces-list",
          registerPath: "/faces-register",
        },
        window.__FACE_STORE_CONFIG__
      );
    </script>
    <script defer src="app.js"></script>
  </head>
  <body>
    <header>
      <h1>人臉辨識</h1>
      <p>載入模型並啟用攝影機，系統會即時進行人臉辨識。</p>
    </header>

    <main>
      <section class="controls">
        <div class="loader">
          <button id="load-models-btn" class="primary">載入模型</button>
          <span id="models-status" class="status">模型尚未載入</span>
        </div>

        <div class="known-face-form">
          <label>
            標籤名稱
            <input id="label-input" type="text" placeholder="例如：Alice" />
          </label>
          <label class="file-input">
            照片
            <input id="images-input" type="file" accept="image/*" multiple />
          </label>
          <div class="known-actions">
            <button id="add-known-btn">加入已知人像（上傳）</button>
            <button id="capture-known-btn">拍照加入已知人像</button>
          </div>
        </div>

        <div class="known-list">
          <h2>已知人物列表</h2>
          <ul id="known-list"></ul>
        </div>

        <div class="cache-controls">
          <button id="clear-cache-btn" type="button">清除本機快取</button>
          <p class="cache-note">刪除後本機將不再保留任何人像資料</p>
        </div>

        <div class="camera-controls">
          <button id="start-camera-btn" class="primary">啟動攝影機</button>
          <button id="stop-camera-btn">停止攝影機</button>
          <span id="camera-status" class="status">攝影機未啟動</span>
        </div>
      </section>

      <section class="preview">
        <div class="video-wrapper">
          <video
            id="video"
            class="video-feed"
            width="640"
            height="480"
            autoplay
            muted
            playsinline
          ></video>
          <canvas id="overlay" class="overlay" width="640" height="480"></canvas>
        </div>
      </section>
    </main>

    <footer>
      <p>
        本頁面使用 <code>face-api.js</code> 在瀏覽器端進行推論，人像資料僅透過設定的安全管道儲存。
      </p>
    </footer>
  </body>
</html>
